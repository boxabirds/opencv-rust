<!DOCTYPE html>
<html>
<head><title>Farneback Quick Test</title></head>
<body>
  <h1>Farneback Optical Flow - Quick Test</h1>
  <div id="output"></div>
  <script type="module">
    import init, { WasmMat, farnebackOpticalFlow } from './pkg/opencv_rust.js';

    async function test() {
      const output = document.getElementById('output');
      try {
        await init();
        output.textContent = 'Initialized...\\n';

        // Test with 64x64 image (same as test suite will use)
        const size = 64;
        const data = new Uint8ClampedArray(size * size * 4);
        for (let i = 0; i < data.length; i += 4) {
          data[i] = Math.random() * 255;
          data[i+1] = Math.random() * 255;
          data[i+2] = Math.random() * 255;
          data[i+3] = 255;
        }

        const mat = WasmMat.fromImageData(data, size, size, 4);
        const start = performance.now();
        const result = await farnebackOpticalFlow(mat);
        const elapsed = performance.now() - start;

        if (result) {
          output.textContent += `✓ Farneback with 64x64: ${elapsed.toFixed(2)}ms\\n`;
          result.free();
        } else {
          output.textContent += `✗ Farneback returned null\\n`;
        }
        mat.free();

        output.textContent += '\\n✓ Test completed!';
      } catch (e) {
        output.textContent += `\\n✗ ERROR: ${e.message}\\n${e.stack}`;
      }
    }

    test();
  </script>
</body>
</html>
